var formatGoogleCalendar=function(){"use strict";var config,init=function(settings){var result=[];config=settings;var finalURL=settings.calendarUrl;moment.updateLocale("sv",{calendar:{sameDay:"[Idag]",nextDay:"[Imorgon]",lastDay:"[IgÃ¥r]",nextWeek:"dddd D MMMM",lastWeek:"[I] dddd[s]",sameElse:"dddd D MMMM"}}),settings.recurringEvents&&(finalURL=finalURL.concat("&singleEvents=true")),settings.past||(finalURL=finalURL.concat("&orderBy=startTime&timeMin="+moment().startOf("day").toISOString())),settings.upcomingTopN>0&&(finalURL=finalURL.concat("&maxResults="+settings.upcomingTopN)),fetch(finalURL).then(response=>response.json()).then(data=>{var lastDate;null!=data.items&&data.items.forEach((function removeCancelledEvents(item){item&&item.hasOwnProperty("status")&&"cancelled"!==item.status&&result.push(item)})),result.sort(comp).reverse();var pastCounter=0,upcomingCounter=0,pastResult=[],upcomingResult=[],upcomingResultTemp=[],$upcomingElem=$(settings.upcomingSelector),$pastElem=$(settings.pastSelector),i;for(i in-1===settings.pastTopN&&(settings.pastTopN=result.length),-1===settings.upcomingTopN&&(settings.upcomingTopN=result.length),!1===settings.past&&(settings.pastTopN=0),!1===settings.upcoming&&(settings.upcomingTopN=0),result)isPast(result[i].end.dateTime||result[i].end.date)?pastCounter<settings.pastTopN&&(pastResult.push(result[i]),pastCounter++):upcomingResultTemp.push(result[i]);for(i in upcomingResultTemp.reverse(),upcomingResultTemp)upcomingCounter<settings.upcomingTopN&&(upcomingResult.push(upcomingResultTemp[i]),upcomingCounter++);for(i in pastResult)$pastElem.append(semanticTransformationList(pastResult[i],settings.itemsTagName,settings.format));var countDays=0;for(i in upcomingResult){if(isSameDate(new Date(upcomingResult[i].start.dateTime||upcomingResult[i].start.date),lastDate)||countDays++,countDays>settings.daysToShow+1)break;$upcomingElem.append(semanticTransformationList(upcomingResult[i],settings.itemsTagName,settings.format,lastDate)),lastDate=new Date(upcomingResult[i].start.dateTime||upcomingResult[i].start.date)}})},comp=function(a,b){return new Date(a.start.dateTime||a.start.date).getTime()-new Date(b.start.dateTime||b.start.date).getTime()},mergeOptions=function(defaultSettings,overrideSettings){var newObject={},i;for(i in defaultSettings)newObject[i]=defaultSettings[i];for(i in overrideSettings)newObject[i]=overrideSettings[i];return newObject},isAllDay=function(dateStart,dateEnd){var dateStartFormatted=getDateFormatted(dateStart),dateEndFormatted=getDateFormatted(dateEnd);return dateStartFormatted.getTime()===dateEndFormatted.getTime()-864e5&&0===dateStartFormatted.getMinutes()&&0===dateStartFormatted.getHours()},semanticTransformationList=function(result,tagName,format,lastDate){var dateStart=moment(result.start.dateTime||result.start.date),dateEnd=moment(result.end.dateTime||result.end.date),moreDaysEvent=moment(dateEnd.subtract(1,"days")).isAfter(dateStart,"day"),dayNames=config.dayNames,isAllDayEvent=isAllDay(dateStart,dateEnd);if(!moreDaysEvent){isAllDayEvent&&(dateEnd=subtractOneMinute(dateEnd));var dateFormatted=getFormattedDate(dateStart,dateEnd,moreDaysEvent,isAllDayEvent,dayNames),output="",summary=result.summary||"",description=result.description||"",location=result.location||"",i,dateMoment=moment(result.start.dateTime||result.start.date).calendar();if(!isSameDate(new Date(result.start.dateTime||result.start.date),lastDate)){var template=$("#mallDatum").html();Mustache.parse(template);var rendered=Mustache.render(template,{date:dateMoment});output=output.concat(rendered)}var kalenderTemplate="#mallHandelse",ikonTemplate="#ikonHandelse",re=/(?:^|\W)#(\w+)(?!\w)/g,match,matches=[];for($(config.defaultEventTemplates).each((function(xIndex,item){var name;if(new RegExp(item[0],"i").test(summary))return ikonTemplate=item[1],!1}));match=re.exec(description);)~match[0].indexOf("#mall")&&(kalenderTemplate=match[0]),~match[0].indexOf("#ikon")&&(ikonTemplate=match[0]);description=description.replace(re,""),kalenderTemplate=$(kalenderTemplate).html(),ikonTemplate=$(ikonTemplate).html();var timeSpan="";result.start.dateTime&&(timeSpan=moment(result.start.dateTime).format("LT-")+moment(result.end.dateTime).format("LT"));var metaTemplate="";if(timeSpan&&(metaTemplate=metaTemplate.concat(Mustache.render($("#metaTid").html(),{timespan:timeSpan}))),location&&(metaTemplate=metaTemplate.concat(Mustache.render($("#metaPlats").html(),{location:splitLocation(location),address:location}))),description&&(metaTemplate=metaTemplate.concat(Mustache.render($("#metaBeskrivning").html(),{description:description}))),kalenderTemplate){Mustache.parse(kalenderTemplate);var rendered=Mustache.render(kalenderTemplate,{icon:ikonTemplate,summary:summary,description:description,location:location,timespan:timeSpan,meta:metaTemplate});output=output.concat(rendered)}return $(".addDate").each((function(xIndex,segment){var name;if(new RegExp(segment.id,"i").test(summary)){var dateTemplate=$("#nextDatum").html(),rendered=Mustache.render(dateTemplate,{icon:ikonTemplate,summary:summary,date:dateMoment,timespan:timeSpan}),kids=$("#"+segment.id).children().eq(0).append(rendered);$("#"+segment.id).removeClass("addDate")}})),output}},isPast=function(date){var compareDate=new Date(date),now;return(new Date).getTime()>compareDate.getTime()},isSameDate=function(firstDate,secondDate){return void 0!==firstDate&&void 0!==secondDate&&(firstDate.getMonth()===secondDate.getMonth()&&firstDate.getDate()===secondDate.getDate()&&firstDate.getFullYear()===secondDate.getFullYear())},getDateInfo=function(date){return[(date=new Date(date)).getDate(),date.getMonth(),date.getFullYear(),date.getHours(),date.getMinutes(),0,0]},getMonthName=function(month){var monthNames;return["Januari","Februari","Mars","April","Maj","Juni","Juli","Augusti","September","Oktober","November","December"][month]},getDayName=function(day){var dayNames;return["S&ouml;ndag","M&aring;ndag","Tisdag","Onsdag","Torsdag","Fredag","L&ouml;rdag"][day]},getDayNameFormatted=function(dateFormatted){return getDayName(getDateFormatted(dateFormatted).getDay())+" "},getDateFormatted=function(dateInfo){return new Date(dateInfo[2],dateInfo[1],dateInfo[0],dateInfo[3],dateInfo[4]+0,0)},getDateNiceFormatted=function(dateInfo){return new Date(dateInfo[2],dateInfo[1],dateInfo[0],dateInfo[3],dateInfo[4]+0,0)},addOneDay=function(dateInfo){var date=getDateFormatted(dateInfo);return date.setTime(date.getTime()+864e5),getDateInfo(date)},subtractOneDay=function(dateInfo){var date=getDateFormatted(dateInfo);return date.setTime(date.getTime()-864e5),getDateInfo(date)},subtractOneMinute=function(dateInfo){var date=getDateFormatted(dateInfo);return date.setTime(date.getTime()-6e4),getDateInfo(date)},formatDateSameDay=function(dateStart,dateEnd,moreDaysEvent,isAllDayEvent,dayNames){var formattedTime="",dayNameStart="";return dayNames&&(dayNameStart=getDayNameFormatted(dateStart)),!config.sameDayTimes||moreDaysEvent||isAllDayEvent||(formattedTime=getFormattedTime(dateStart)+" - "+getFormattedTime(dateEnd)),dayNameStart+dateStart[0]+" "+getMonthName(dateStart[1])},formatDateSameDayOld=function(dateStart,dateEnd,moreDaysEvent,isAllDayEvent,dayNames){var formattedTime="",dayNameStart="";return dayNames&&(dayNameStart=getDayNameFormatted(dateStart)),!config.sameDayTimes||moreDaysEvent||isAllDayEvent||(formattedTime=getFormattedTime(dateStart)+" - "+getFormattedTime(dateEnd)),dayNameStart+dateStart[0]+" "+getMonthName(dateStart[1])+", "+dateStart[2]+formattedTime},formatDateOneDay=function(dateStart,dayNames){var dayName="";return dayNames&&(dayName=getDayNameFormatted(dateStart)),dayName+getMonthName(dateStart[1])+" "+dateStart[0]+", "+dateStart[2]},formatDateDifferentDay=function(dateStart,dateEnd,dayNames){var dayNameStart="",dayNameEnd="";return dayNames&&(dayNameStart=getDayNameFormatted(dateStart),dayNameEnd=getDayNameFormatted(dateEnd)),dayNameStart+dateStart[0]+" "+getMonthName(dateStart[1])},formatDateDifferentMonth=function(dateStart,dateEnd,dayNames){var dayNameStart="",dayNameEnd="";return dayNames&&(dayNameStart=getDayNameFormatted(dateStart),dayNameEnd=getDayNameFormatted(dateEnd)),dayNameStart+getMonthName(dateStart[1])+" "+dateStart[0]+"-"+dayNameEnd+getMonthName(dateEnd[1])+" "+dateEnd[0]+", "+dateStart[2]},formatDateDifferentYear=function(dateStart,dateEnd,dayNames){var dayNameStart="",dayNameEnd="";return dayNames&&(dayNameStart=getDayNameFormatted(dateStart),dayNameEnd=getDayNameFormatted(dateEnd)),dayNameStart+getMonthName(dateStart[1])+" "+dateStart[0]+", "+dateStart[2]+"-"+dayNameEnd+getMonthName(dateEnd[1])+" "+dateEnd[0]+", "+dateEnd[2]},getFormattedDate=function(dateStart,dateEnd,moreDaysEvent,isAllDayEvent,dayNames){var formattedDate="";return formattedDate=dateStart[0]===dateEnd[0]?dateStart[1]===dateEnd[1]?dateStart[2]===dateEnd[2]?formatDateSameDay(dateStart,dateEnd,moreDaysEvent,isAllDayEvent,dayNames):formatDateDifferentYear(dateStart,dateEnd,dayNames):dateStart[2]===dateEnd[2]?formatDateDifferentMonth(dateStart,dateEnd,dayNames):formatDateDifferentYear(dateStart,dateEnd,dayNames):dateStart[1]===dateEnd[1]?dateStart[2]===dateEnd[2]?formatDateDifferentDay(dateStart,dateEnd,dayNames):formatDateDifferentYear(dateStart,dateEnd,dayNames):dateStart[2]===dateEnd[2]?formatDateDifferentMonth(dateStart,dateEnd,dayNames):formatDateDifferentYear(dateStart,dateEnd,dayNames)},getFormattedTime=function(date){var formattedTime="",hour=date[3],minute=date[4];return 0===hour&&(hour=24),formattedTime=hour+":"+(minute=(minute<10?"0":"")+minute)};function splitLocation(str){var i=str.indexOf(",");return i>0?str.slice(0,i):""}return{init:function(settingsOverride){var settings={calendarUrl:"",past:!0,upcoming:!0,sameDayTimes:!0,dayNames:!0,pastTopN:-1,upcomingTopN:-1,recurringEvents:!0,itemsTagName:"li",upcomingSelector:"#events-upcoming",pastSelector:"#events-past",upcomingHeading:"<h2>Upcoming events</h2>",pastHeading:"<h2>Past events</h2>",format:["*date*",": ","*summary*"," &mdash; ","*description*"," in ","*location*"],daysToShow:4};settings=mergeOptions(settings,settingsOverride),init(settings)}}}();