<!DOCTYPE html>
<!-- Template by Quackit.com -->
<html lang="en">
<head>
    <title>Tsuzukiwazas</title>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <!-- Android mobile -->
    <meta name="mobile-web-app-capable" content="yes">
    <link rel="shortcut icon" sizes="192x192" href="/fav/logoWB192x.webp">
    <link rel="shortcut icon" sizes="128x128" href="/fav/logoWB128x.webp">
    <link rel="manifest" href="manifest_tw.json">
    <!-- iPhone mobile -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon" href="/fav/logoWB128x.webp">
    <link rel="apple-touch-startup-image" href="/fav/logoWB128x.webp">
    <link rel="apple-touch-icon" sizes="128x128" href="/fav/logoWB128x.webp">
    <link rel="apple-touch-icon" sizes="76x76" href="/fav/logoWB76x.webp">
    <link rel="apple-touch-icon" sizes="120x120" href="/fav/logoWB120x.webp">
    <link rel="apple-touch-icon" sizes="152x152" href="/fav/logoWB152x.webp.webp">
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
    <link href="https://cdn.rawgit.com/Daugilas/lazyYT/a52252c3/lazyYT.css" rel="stylesheet">
    <style>
        body {
            padding-top: 30px;
        }

        .jumbotron {
            background-color: #ffffff !important;
        }

        h1, h2, h3, h4, h5, h6 {
            color: black;
        }

        .article-intro {
            margin-bottom: 25px;
        }

        .footer-blurb-item {
            padding: 10px 10px 10px 20px;
        }

        .small-print {
            background-color: #000000;
            padding: 30px 0;
        }

        .navbar-collapse.collapse {
            display: none !important;
        }

            .navbar-collapse.collapse.in {
                display: block !important;
            }

        .navbar-header .collapse, .navbar-toggle {
            display: block !important;
        }

        .navbar-header {
            float: none;
        }

        .glyphicon-refresh-animate {
            -animation: spin .7s infinite linear;
            -ms-animation: spin .7s infinite linear;
            -webkit-animation: spinw .7s infinite linear;
            -moz-animation: spinm .7s infinite linear;
        }

        @keyframes spin {
            from {
                transform: scale(1) rotate(0deg);
            }

            to {
                transform: scale(1) rotate(360deg);
            }
        }

        @-webkit-keyframes spinw {
            from {
                -webkit-transform: rotate(0deg);
            }

            to {
                -webkit-transform: rotate(360deg);
            }
        }

        @-moz-keyframes spinm {
            from {
                -moz-transform: rotate(0deg);
            }

            to {
                -moz-transform: rotate(360deg);
            }
        }
    </style>
</head>

<body>
    <nav class="navbar navbar-inverse navbar-fixed-top" role="navigation">
        <div class="container">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
            </div>
            <div class="collapse navbar-collapse" id="navbar">
                <ul id="navul" class="nav navbar-nav">
                </ul>
            </div>
        </div>
    </nav>

	<div class="jumbotron feature">
		<div class="container">
            <div class="form-group" id="loader">
                <div class="col-md-12 text-center">
                    <span style="font-size:10em;" class="glyphicon glyphicon-refresh glyphicon-refresh-animate"></span>
                </div>
            </div>
			<p id="topic"></p>
			<p><ul id="description"></ul></p>
			<p id="Yoshimovie"></p>
		</div>
	</div>
    <div class="container" id="moviesDiv" style="display:none">
        <div class="row" id="movies">
        </div>
    </div>
	<footer style="display:none" id="footerDiv">
		<div class="footer-blurb">
			<div class="container">
				<div class="row">
					<div class="col-sm-4 footer-blurb-item">
						<h3><span class="glyphicon glyphicon-fire"></span> Klassificering</h3>
						<p id="Klassificering"></p>
					</div>
					<div class="col-sm-4 footer-blurb-item">
						<h3><span class="glyphicon glyphicon-cloud-upload"></span> Ordlista</h3>
						<p id="Ordlista"></p>
					</div>
				</div>
				<!-- /.row -->	
			</div>
        </div>
	</footer>
    <script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
	<script src="js/marked.min.js"></script>
    <script src="https://cdn.rawgit.com/Daugilas/lazyYT/a52252c3/lazyYT.js"></script>
	
<script type="text/javascript"> 
function querystring(key) {
   var re=new RegExp('(?:\\?|&)'+key+'=(.*?)(?=&|$)','gi');
   var r=[], m;
   while ((m=re.exec(document.location.search)) != null) r.push(m[1]);
   return r;
}

$(document).ready(function() {	
//source file is https://docs.google.com/spreadsheet/ccc?key=0Ak0qDiMLT3XddHlNempadUs1djdkQ0tFLWF6ci1rUUE	
//$.getJSON( "https://spreadsheets.google.com/feeds/list/0Ak0qDiMLT3XddHlNempadUs1djdkQ0tFLWF6ci1rUUE/od6/public/values?alt=json",
    
    $(function listBooks() {
        var weekNumber = (new Date()).getWeek();
        var localData = localStorage.getObject('twDatavecka' + weekNumber);
        var localDict = localStorage.getObject('twDictvecka' + weekNumber);

        if (localData === null) {
            $.getJSON("https://spreadsheets.google.com/feeds/list/1DBGA8wHPPVc_gbpIlMmUIwHSdHqCg_ZnKzwoYfDX2B4/oyb1mi3/public/values?gid=2074401521&alt=json",
                function (data) {
                    $.getJSON("https://spreadsheets.google.com/feeds/list/1DBGA8wHPPVc_gbpIlMmUIwHSdHqCg_ZnKzwoYfDX2B4/oitqgfe/public/values?gid=1138334576&alt=json",
                        function (dict) {
                            //localstorage expires every monday
                            localStorage.clear();
                            localStorage.setObject('twDatavecka' + weekNumber, data);
                            localStorage.setObject('twDictvecka' + weekNumber, dict);
                            ProcessData(data, dict);
                        });
                });
        }
        else
        {
            ProcessData(localData, localDict);
        }
    });

    Storage.prototype.setObject = function (key, value) {
        this.setItem(key, JSON.stringify(value));
    }

    Storage.prototype.getObject = function (key) {
        var value = this.getItem(key);
        return value && JSON.parse(value);
    }

    Date.prototype.getWeek = function () {
        var onejan = new Date(this.getFullYear(), 0, 1);
        return Math.ceil((((this - onejan) / 86400000) + onejan.getDay() + 1) / 7);
    }

    function ProcessData(data, dict) {
        var query = querystring('nr')[0];
        if (query == undefined) {
            query = "1";
        }

        $('div#book-list').append('<ul class="items"></ul>');
        var numbers = "";

        $.each(data.feed.entry, function (i, entry) {
            var nr = entry.gsx$nummer.$t;

            if (query == nr) {
                $('#loader').hide();
                $('#moviesDiv').show();
                $('#footerDiv').show();
                numbers += '<li class="active"><a href="?nr=' + nr + '">TW ' + nr + ' ' + entry.gsx$attack.$t + '</a></li>';

                $('p#topic').append('<h3>Tsuzukiwaza ' + nr + '</h3><h1>' + entry.gsx$attack.$t + '</h1>');

                $('p#Yoshimovie').append('<a href="' + entry.gsx$filmyoshigasaki.$t + '">Yoshigasakis film (ekia2012)</a>')

                var item = "";

                for (x = 1; x < 15; x++) {
                    if (eval('entry.gsx$teknik' + x) != undefined && eval('entry.gsx$teknik' + x + '.$t') != "") {
                        item += '<li>' + eval('entry.gsx$teknik' + x + '.$t') + '</li>'
                    }
                }

                $('ul#description').append(item);

                var finder = entry.gsx$ordlista.$t.split(';');

                $('#Klassificering').append(marked(entry.gsx$klassificering.$t));

                for (x = 1; x < 11; x++) {
                    if (eval('entry.gsx$film' + x) != undefined && eval('entry.gsx$film' + x + '.$t') != "") {
                        var movie = '<article class="col-md-8 article-intro">';
                        //movie += '<div class="embed-responsive embed-responsive-16by9"><iframe data-loader="youtube" class="embed-responsive-item" src="https://www.youtube.com/embed/' + eval('entry.gsx$film' + x + '.$t').substring(32) + '" frameborder="0" allowfullscreen></iframe></div>';
                        movie += '<div class="embed-responsive embed-responsive-16by9"><div class="lazyYT" data-youtube-id="'+ eval('entry.gsx$film' + x + '.$t').substring(32) +'">Klicka mig</div></div>'
                        movie += '</article>';
                        $('div#movies').append(movie);
                    }
                }

                $('.lazyYT').lazyYT('AIzaSyC911J-UtcGPB8SIWUm-_Her-fXBusUdwI');

                if (finder.length > 0) {
                    var words = "";
                    $.each(dict.feed.entry, function (x, desc) {

                        if ($.inArray(desc.gsx$nummer.$t, finder) != -1) {
                            words += '<li>' + desc.gsx$word.$t + ' - ' + desc.gsx$description.$t + '</li>'
                        }
                    });
                    $('p#Ordlista').append(words);
                }
            }
            else {
                numbers += '<li><a href="?nr=' + nr + '">TW ' + nr + ' ' + entry.gsx$attack.$t + '</a></li>';
            }
        });
        $('ul#navul').append(numbers);
    };
});

</script>	
</body>
</html>
